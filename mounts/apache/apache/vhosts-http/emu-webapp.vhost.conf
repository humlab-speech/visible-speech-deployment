<VirtualHost *:80>
  ServerName emu-webapp.${HS_DOMAIN_NAME}

  RequestHeader set X-Forwarded-Proto https
  ProxyPreserveHost On

  # Use RewriteEngine to handle websocket connection upgrades
  RewriteEngine On
  RewriteCond %{HTTP:Connection} Upgrade [NC]
  RewriteCond %{HTTP:Upgrade} websocket [NC]
  RewriteRule /(.*) ws://emu-webapp:9000/$1 [P,L]

  <Location "/">
    # proxy to SessionManager/Container
    Header unset x-frame-options
    Header unset Content-Security-Policy
    ProxyPass         http://emu-webapp:9000/
    ProxyPassReverse  http://emu-webapp:9000/
  </Location>

  ServerAdmin support@humlab.umu.se

  ErrorLog ${APACHE_LOG_DIR}/emu-webapp-error.log
  CustomLog ${APACHE_LOG_DIR}/emu-webapp-access.log combined

</VirtualHost>
