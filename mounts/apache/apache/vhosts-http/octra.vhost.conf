<VirtualHost *:80>
  ServerName octra.${BASE_DOMAIN}

  RequestHeader set X-Forwarded-Proto "https"

  # Map /api to the webapi filesystem
  Alias /api /var/www/html/api

  # Top-level rewrite rule (before fallback to index.php)
  # This is so that octra can call on /api/ urls and reach the WebApi
  RewriteEngine On
  RewriteRule ^/api/v1/(.*)$ /api/api.php [L]

  ProxyPreserveHost On
  RequestHeader set X-Forwarded-For "%{REMOTE_ADDR}e"
  RequestHeader set X-Forwarded-Proto "https"

  ProxyPass / http://octra/
  ProxyPassReverse / http://octra.${BASE_DOMAIN}

  # Use RewriteEngine to handle websocket connection upgrades
  RewriteCond %{HTTP:Connection} Upgrade [NC]
  RewriteCond %{HTTP:Upgrade} websocket [NC]
  RewriteRule /(.*) ws://octra/$1 [P,L]

  ServerAdmin support@humlab.umu.se

  ErrorLog ${APACHE_LOG_DIR}/octra-error.log
  CustomLog ${APACHE_LOG_DIR}/octra-access.log combined

</VirtualHost>
