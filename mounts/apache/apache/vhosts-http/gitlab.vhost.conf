<VirtualHost *:80>
  ServerName gitlab.${BASE_DOMAIN}
  
  Header set Access-Control-Allow-Origin "*"
  RequestHeader set X-Forwarded-Proto "https"

  AllowEncodedSlashes NoDecode

  ProxyPreserveHost On
  #nocanon is needed to pass the raw urls without modifying things such as %2f
  ProxyPass / http://gitlab:80/ nocanon
  ProxyPassReverse / https://gitlab.${BASE_DOMAIN}
  ProxyRequests off

  ServerAdmin support@humlab.umu.se

  LogLevel info
  ErrorLog ${APACHE_LOG_DIR}/gitlab-error.log
  CustomLog ${APACHE_LOG_DIR}/gitlab-access.log combined

</VirtualHost>
